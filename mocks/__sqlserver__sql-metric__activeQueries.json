{"status":200,"headers":{"server":"openresty/1.15.8.2","date":"Mon, 01 May 2023 06:10:36 GMT","content-type":"application/json","transfer-encoding":"chunked","connection":"close","vary":"Accept-Encoding","strict-transport-security":"max-age=15724800; includeSubDomains"},"data":{"metricInput":{"metricId":"performance_activeQueries","metricPeriod":"REAL_TIME","databaseName":"udprodsql/db-prod","databaseType":"SQLSERVER","from":null,"to":null,"recommendationRequired":false},"metricOutput":{"result":{"queryList":[{"sessionId":307,"status":"running","blockedBy":0,"waitType":null,"waitResource":"","percentComplete":0,"waitTime":"00:00:00","cpuTime":42,"logicalReads":14124,"reads":1,"writes":0,"elapsedTime":"0d 00:00:00","queryText":"<?query --  \n\nselect order_id seller_order_id, seller_id, buyer_id, order_status, order_type, sum(sol.order_line_sp_paise) as total_selling_price_paise, extra_data, so.created_at,\n      sum(tl.tax_amount_paise) total_tax_amount_paise, min(so.last_updated_at) earliest,\n      sum(sol.order_line_sp_paise - (sol.order_line_sp_paise * CASE WHEN JSON_VALUE(pricing_options, '$.pricing_options[0].availed') = 'true'\n      THEN ISNULL(JSON_VALUE(JSON_VALUE(pricing_options, '$.pricing_options[0].meta_data'),\n      '$.net_cash_discount_bps'), 0) ELSE 0 END)/10000) cash_discount_in_paise,\n      sum(tl.tax_amount_paise - (tl.tax_amount_paise * CASE WHEN JSON_VALUE(pricing_options, '$.pricing_options[0].availed') = 'true'\n            THEN ISNULL(JSON_VALUE(JSON_VALUE(pricing_options, '$.pricing_options[0].meta_data'),\n            '$.net_cash_discount_bps'), 0) ELSE 0 END)/10000) cash_tax_discount_in_paise,\n      max(json_value(sol.misc_info, '$.max_esla_hours')) eta_since_created_in_hours, fl.fulfillment_center\n    from seller_order so\n      join seller_order_line sol on sol.seller_order_id = so.order_id and sol.current_active = 1\n      left outer join fulfillment_line fl on fl.seller_order_id = so.order_id and fl.current_active = 1\n      left join tax_line tl on tl.taxable_entity_id = sol.order_line_id and sol.current_active = 1 and tl.current_active = 1\n    where so.order_id in ( select so.order_id from seller_order so where so.created_at < @P0 and\n                so.order_status in (@P1,@P2,@P3,@P4,@P5,@P6,@P7,@P8,@P9,@P10,@P11,@P12,@P13,@P14,@P15,@P16,@P17,@P18,@P19) and so.buyer_id = @P20 and so.seller_id != @P21\n                ORDER BY so.created_at DESC, so.order_id ASC\n                OFFSET 0 ROWS FETCH NEXT @P22 ROWS ONLY)\n                and so.current_active = 1\n    GROUP BY order_id, seller_id, buyer_id, order_status, order_type, total_order_sp_paise, extra_data, so.created_at, fl.fulfillment_center\n    ORDER BY so.created_at DESC, order_id ASC\n    OFFSET 0 ROWS FETCH NEXT @P23 ROWS ONLY\n\n--?>","storedProc":"","command":"SELECT","loginName":"udaan","hostName":"canary-order-mgt-buyer-svc-7cf4c66b4f-2mthx","programName":"canary-order-mgt-buyer-svc-7cf4c66b4f-2mthx/order-mgmt","hostProcessId":0,"lastRequestEndTime":"2023-05-01 06:10:36.677","loginTime":"2023-05-01 06:09:43.777","openTransactionCount":0},{"sessionId":469,"status":"running","blockedBy":0,"waitType":null,"waitResource":"","percentComplete":0,"waitTime":"00:00:00","cpuTime":0,"logicalReads":0,"reads":0,"writes":0,"elapsedTime":"0d 00:00:00","queryText":"<?query --  \n\nSELECT sessionId=s.session_id\n ,status=r.STATUS\n ,blockedBy=r.blocking_session_id\n ,waitType=r.wait_type\n, waitResource=r.wait_resource\n, waitTime=CONVERT(VARCHAR, DATEADD(ms, r.wait_time, 0), 8)\n, cpuTime=r.cpu_time\n, logicalReads=r.logical_reads\n, r.reads\n ,r.writes,\n r.percent_complete as percentComplete\n,elapsedTime=CONVERT(varchar, (r.total_elapsed_time/1000 / 86400))+ 'd ' +\n CONVERT(VARCHAR, DATEADD(ms, r.total_elapsed_time, 0), 8)\n ,queryText=CAST((\n         '<?query --  ' + CHAR(13) + CHAR(13) + Substring(st.TEXT, (r.statement_start_offset / 2) + 1, (\n  (\n CASE r.statement_end_offset\n WHEN - 1\n THEN Datalength(st.TEXT)\n  ELSE r.statement_end_offset\n END - r.statement_start_offset\n) / 2\n) + 1) + CHAR(13) + CHAR(13) + '--?>'\n ) AS XML)\n, storedProc=COALESCE(\n QUOTENAME(DB_NAME(st.dbid)) + N'.' + \n QUOTENAME(OBJECT_SCHEMA_NAME(st.objectid, st.dbid)) + N'.' +\n QUOTENAME(OBJECT_NAME(st.objectid, st.dbid)), ''\n)\n  --,qp.query_plan AS 'xml_plan'  -- uncomment (1) if you want to see plan\n, r.command\n ,loginName=s.login_name\n ,hostName=s.host_name\n ,programName=s.program_name\n ,hostProcessId=s.host_process_id\n ,lastRequestEndTime=s.last_request_end_time\n ,loginTime=s.login_time\n ,openTransactionCount=r.open_transaction_count\n FROM sys.dm_exec_sessions AS s\n INNER JOIN sys.dm_exec_requests AS r ON r.session_id = s.session_id\n CROSS APPLY sys.dm_exec_sql_text(r.sql_handle) AS st\n --OUTER APPLY sys.dm_exec_query_plan(r.plan_handle) AS qp -- uncomment (2) if you want to see plan \n ORDER BY r.blocking_session_id\n\n--?&gt;","storedProc":"","command":"SELECT","loginName":"384d3f58-b6c5-42b9-a0fd-ae1489af9da2@77200122-6280-4dcc-abf6-a2d3708165da","hostName":"sql-monitoring-service-5b68d7bd56-v59w5","programName":"sql-monitoring-service-5b68d7bd56-v59w5/application/sql-monitoring/udprodsql/db-prod","hostProcessId":0,"lastRequestEndTime":"2023-05-01 06:10:36.717","loginTime":"2023-04-26 10:53:05.607","openTransactionCount":0},{"sessionId":559,"status":"running","blockedBy":0,"waitType":null,"waitResource":"","percentComplete":0,"waitTime":"00:00:00","cpuTime":1,"logicalReads":0,"reads":0,"writes":0,"elapsedTime":"0d 00:00:00","queryText":"<?query --  \n\nSELECT isa.shipment_group_id, inv.invoice_id, inv.invoice_ref_id, inv.created_at invoice_created_at, inv.amount_in_paisa, inv.buyer_org_id, inv.seller_org_id, inv.invoice_type, inv.num_of_items, ol.order_line_id, ol.order_line_status, ol.listing_id, ol.sales_unit_id, ol.units, ol.per_unit_sp_paise, ol.order_line_sp_paise, ol.misc_info, ol.credit_details, ol.item_type, ol.properties, tl.tax_line_id, tl.taxable_entity_id, tl.taxable_entity_type, tl.tax_type, tl.tax_amount_paise, tl.tax_master_id, so.extra_data, so.order_type, so.total_order_sp_paise, so.order_status, so.buyer_id, so.seller_id, op.payment_method order_payment, block_id, op.amount_in_paisa amount_in_paisa_mode, cac.amount_in_paisa as consumed_amount_in_paisa FROM invoice_shipment_group_association isa LEFT OUTER JOIN invoice inv on inv.invoice_id = isa.invoice_id and inv.current_active = 1 LEFT OUTER JOIN fulfillment_line_items ffi on ffi.shipment_group_id = isa.shipment_group_id LEFT OUTER JOIN seller_order_line ol on ol.order_line_id = ffi.order_line_id LEFT OUTER JOIN tax_line tl on tl.taxable_entity_id = ol.order_line_id and tl.current_active = 1 LEFT OUTER JOIN seller_order so on so.order_id = ol.seller_order_id LEFT OUTER JOIN order_payments op on op.order_id = so.order_id LEFT OUTER JOIN collected_advance_consumable cac with(index(consumed_for_idx)) on cac.consumed_for = isa.shipment_group_id WHERE isa.shipment_group_id IN (@P0) AND isa.current_active = 1\n\n--?>","storedProc":"","command":"SELECT","loginName":"udaan","hostName":"logistics-console-service-68dc954f59-spc2g","programName":"logistics-console-service-68dc954f59-spc2g/order-mgmt","hostProcessId":0,"lastRequestEndTime":"2023-05-01 06:10:36.73","loginTime":"2023-05-01 06:06:51.483","openTransactionCount":1},{"sessionId":588,"status":"running","blockedBy":0,"waitType":null,"waitResource":"","percentComplete":0,"waitTime":"00:00:00","cpuTime":3,"logicalReads":270,"reads":0,"writes":0,"elapsedTime":"0d 00:00:00","queryText":"<?query --  \n\nSELECT \n    so.order_id, \n    so.total_order_sp_paise, \n    so.buyer_id, \n    so.seller_id, \n    so.order_status, \n    so.extra_data, \n    so.order_type, \n    so.created_at,\n    CAST((CONVERT(bigint, so.updated_at)) as decimal) as updated_at,\n    so.order_meta_info, \n    so.last_updated_at, \n    ol.order_line_id, \n    ol.order_line_status, \n    ol.listing_id, \n    ol.sales_unit_id, \n    ol.units, \n    ol.per_unit_sp_paise, \n    ol.order_line_sp_paise,\n    ol.misc_info, \n    ol.credit_details, \n    ol.item_type, \n    ol.properties, \n    ol.pricing_options, \n    ol.offer_details\n        \n        from seller_order so JOIN seller_order_line ol ON \n        ol.seller_order_id = so.order_id and ol.current_active = 1\n         WHERE so.order_id in (select order_id from seller_order so where so.order_status = @P0 and so.current_active = 1 and so.buyer_id = @P1 ORDER BY so.last_updated_at DESC OFFSET 0 ROWS FETCH NEXT @P2 ROWS ONLY)\n\n--?>","storedProc":"","command":"SELECT","loginName":"application_of","hostName":"orderform-service-54d5c58655-4gwv6","programName":"orderform-service-54d5c58655-4gwv6/order-form","hostProcessId":0,"lastRequestEndTime":"2023-05-01 06:10:36.73","loginTime":"2023-05-01 06:09:53.2","openTransactionCount":0},{"sessionId":660,"status":"suspended","blockedBy":0,"waitType":"ASYNC_NETWORK_IO","waitResource":"","percentComplete":0,"waitTime":"00:00:00","cpuTime":2,"logicalReads":61,"reads":0,"writes":0,"elapsedTime":"0d 00:00:00","queryText":"<?query --  \n\nSELECT name,value from config\n\n--?>","storedProc":"","command":"SELECT","loginName":"udaan","hostName":"fpjit-shipment-state-handler-1682921400-47bv6","programName":"Microsoft JDBC Driver for SQL Server","hostProcessId":0,"lastRequestEndTime":"2023-05-01 06:10:35.787","loginTime":"2023-05-01 06:10:35.793","openTransactionCount":0},{"sessionId":869,"status":"running","blockedBy":0,"waitType":null,"waitResource":"","percentComplete":0,"waitTime":"00:00:00","cpuTime":4,"logicalReads":1070,"reads":0,"writes":0,"elapsedTime":"0d 00:00:00","queryText":"<?query --  \n\nSELECT isa.shipment_group_id, inv.invoice_id, inv.invoice_ref_id, inv.created_at invoice_created_at, inv.amount_in_paisa, inv.buyer_org_id, inv.seller_org_id, inv.invoice_type, inv.num_of_items, ol.order_line_id, ol.order_line_status, ol.listing_id, ol.sales_unit_id, ol.units, ol.per_unit_sp_paise, ol.order_line_sp_paise, ol.misc_info, ol.credit_details, ol.item_type, ol.properties, tl.tax_line_id, tl.taxable_entity_id, tl.taxable_entity_type, tl.tax_type, tl.tax_amount_paise, tl.tax_master_id, so.extra_data, so.order_type, so.total_order_sp_paise, so.order_status, so.buyer_id, so.seller_id, op.payment_method order_payment, block_id, op.amount_in_paisa amount_in_paisa_mode, cac.amount_in_paisa as consumed_amount_in_paisa FROM invoice_shipment_group_association isa LEFT OUTER JOIN invoice inv on inv.invoice_id = isa.invoice_id and inv.current_active = 1 LEFT OUTER JOIN fulfillment_line_items ffi on ffi.shipment_group_id = isa.shipment_group_id LEFT OUTER JOIN seller_order_line ol on ol.order_line_id = ffi.order_line_id LEFT OUTER JOIN tax_line tl on tl.taxable_entity_id = ol.order_line_id and tl.current_active = 1 LEFT OUTER JOIN seller_order so on so.order_id = ol.seller_order_id LEFT OUTER JOIN order_payments op on op.order_id = so.order_id LEFT OUTER JOIN collected_advance_consumable cac with(index(consumed_for_idx)) on cac.consumed_for = isa.shipment_group_id WHERE isa.shipment_group_id IN (@P0) AND isa.current_active = 1\n\n--?>","storedProc":"","command":"SELECT","loginName":"udaan","hostName":"logistics-console-service-68dc954f59-pwrvx","programName":"logistics-console-service-68dc954f59-pwrvx/order-mgmt","hostProcessId":0,"lastRequestEndTime":"2023-05-01 06:10:36.73","loginTime":"2023-05-01 06:08:20.34","openTransactionCount":1},{"sessionId":884,"status":"runnable","blockedBy":0,"waitType":null,"waitResource":"","percentComplete":0,"waitTime":"00:00:00","cpuTime":3,"logicalReads":765,"reads":0,"writes":0,"elapsedTime":"0d 00:00:00","queryText":"<?query --  \n\nSELECT isa.shipment_group_id, inv.invoice_id, inv.invoice_ref_id, inv.created_at invoice_created_at, inv.amount_in_paisa, inv.buyer_org_id, inv.seller_org_id, inv.invoice_type, inv.num_of_items, ol.order_line_id, ol.order_line_status, ol.listing_id, ol.sales_unit_id, ol.units, ol.per_unit_sp_paise, ol.order_line_sp_paise, ol.misc_info, ol.credit_details, ol.item_type, ol.properties, tl.tax_line_id, tl.taxable_entity_id, tl.taxable_entity_type, tl.tax_type, tl.tax_amount_paise, tl.tax_master_id, so.extra_data, so.order_type, so.total_order_sp_paise, so.order_status, so.buyer_id, so.seller_id, op.payment_method order_payment, block_id, op.amount_in_paisa amount_in_paisa_mode, cac.amount_in_paisa as consumed_amount_in_paisa FROM invoice_shipment_group_association isa LEFT OUTER JOIN invoice inv on inv.invoice_id = isa.invoice_id and inv.current_active = 1 LEFT OUTER JOIN fulfillment_line_items ffi on ffi.shipment_group_id = isa.shipment_group_id LEFT OUTER JOIN seller_order_line ol on ol.order_line_id = ffi.order_line_id LEFT OUTER JOIN tax_line tl on tl.taxable_entity_id = ol.order_line_id and tl.current_active = 1 LEFT OUTER JOIN seller_order so on so.order_id = ol.seller_order_id LEFT OUTER JOIN order_payments op on op.order_id = so.order_id LEFT OUTER JOIN collected_advance_consumable cac with(index(consumed_for_idx)) on cac.consumed_for = isa.shipment_group_id WHERE isa.shipment_group_id IN (@P0) AND isa.current_active = 1\n\n--?>","storedProc":"","command":"SELECT","loginName":"udaan","hostName":"logistics-console-service-68dc954f59-spc2g","programName":"logistics-console-service-68dc954f59-spc2g/order-mgmt","hostProcessId":0,"lastRequestEndTime":"2023-05-01 06:10:36.72","loginTime":"2023-05-01 06:01:33.0","openTransactionCount":1},{"sessionId":974,"status":"runnable","blockedBy":0,"waitType":null,"waitResource":"","percentComplete":0,"waitTime":"00:00:00","cpuTime":3,"logicalReads":820,"reads":0,"writes":0,"elapsedTime":"0d 00:00:00","queryText":"<?query --  \n\nSELECT isa.shipment_group_id, inv.invoice_id, inv.invoice_ref_id, inv.created_at invoice_created_at, inv.amount_in_paisa, inv.buyer_org_id, inv.seller_org_id, inv.invoice_type, inv.num_of_items, ol.order_line_id, ol.order_line_status, ol.listing_id, ol.sales_unit_id, ol.units, ol.per_unit_sp_paise, ol.order_line_sp_paise, ol.misc_info, ol.credit_details, ol.item_type, ol.properties, tl.tax_line_id, tl.taxable_entity_id, tl.taxable_entity_type, tl.tax_type, tl.tax_amount_paise, tl.tax_master_id, so.extra_data, so.order_type, so.total_order_sp_paise, so.order_status, so.buyer_id, so.seller_id, op.payment_method order_payment, block_id, op.amount_in_paisa amount_in_paisa_mode, cac.amount_in_paisa as consumed_amount_in_paisa FROM invoice_shipment_group_association isa LEFT OUTER JOIN invoice inv on inv.invoice_id = isa.invoice_id and inv.current_active = 1 LEFT OUTER JOIN fulfillment_line_items ffi on ffi.shipment_group_id = isa.shipment_group_id LEFT OUTER JOIN seller_order_line ol on ol.order_line_id = ffi.order_line_id LEFT OUTER JOIN tax_line tl on tl.taxable_entity_id = ol.order_line_id and tl.current_active = 1 LEFT OUTER JOIN seller_order so on so.order_id = ol.seller_order_id LEFT OUTER JOIN order_payments op on op.order_id = so.order_id LEFT OUTER JOIN collected_advance_consumable cac with(index(consumed_for_idx)) on cac.consumed_for = isa.shipment_group_id WHERE isa.shipment_group_id IN (@P0) AND isa.current_active = 1\n\n--?>","storedProc":"","command":"SELECT","loginName":"udaan","hostName":"logistics-console-service-68dc954f59-spc2g","programName":"logistics-console-service-68dc954f59-spc2g/order-mgmt","hostProcessId":0,"lastRequestEndTime":"2023-05-01 06:10:36.717","loginTime":"2023-05-01 06:09:30.84","openTransactionCount":1}]},"recommendation":null},"metadata":{"underlyingQueries":["SELECT sessionId=s.session_id\n ,status=r.STATUS\n ,blockedBy=r.blocking_session_id\n ,waitType=r.wait_type\n, waitResource=r.wait_resource\n, waitTime=CONVERT(VARCHAR, DATEADD(ms, r.wait_time, 0), 8)\n, cpuTime=r.cpu_time\n, logicalReads=r.logical_reads\n, r.reads\n ,r.writes,\n r.percent_complete as percentComplete\n,elapsedTime=CONVERT(varchar, (r.total_elapsed_time/1000 / 86400))+ 'd ' +\n CONVERT(VARCHAR, DATEADD(ms, r.total_elapsed_time, 0), 8)\n ,queryText=CAST((\n         '<?query --  ' + CHAR(13) + CHAR(13) + Substring(st.TEXT, (r.statement_start_offset / 2) + 1, (\n  (\n CASE r.statement_end_offset\n WHEN - 1\n THEN Datalength(st.TEXT)\n  ELSE r.statement_end_offset\n END - r.statement_start_offset\n) / 2\n) + 1) + CHAR(13) + CHAR(13) + '--?>'\n ) AS XML)\n, storedProc=COALESCE(\n QUOTENAME(DB_NAME(st.dbid)) + N'.' + \n QUOTENAME(OBJECT_SCHEMA_NAME(st.objectid, st.dbid)) + N'.' +\n QUOTENAME(OBJECT_NAME(st.objectid, st.dbid)), ''\n)\n  --,qp.query_plan AS 'xml_plan'  -- uncomment (1) if you want to see plan\n, r.command\n ,loginName=s.login_name\n ,hostName=s.host_name\n ,programName=s.program_name\n ,hostProcessId=s.host_process_id\n ,lastRequestEndTime=s.last_request_end_time\n ,loginTime=s.login_time\n ,openTransactionCount=r.open_transaction_count\n FROM sys.dm_exec_sessions AS s\n INNER JOIN sys.dm_exec_requests AS r ON r.session_id = s.session_id\n CROSS APPLY sys.dm_exec_sql_text(r.sql_handle) AS st\n --OUTER APPLY sys.dm_exec_query_plan(r.plan_handle) AS qp -- uncomment (2) if you want to see plan \n ORDER BY r.blocking_session_id"],"referenceDocumentation":[],"description":"","supportsHistorical":false,"supportsAlert":true,"supportedAlerts":["alert_activeQueriesFilter"],"minimumRepeatInterval":"10"}}}
